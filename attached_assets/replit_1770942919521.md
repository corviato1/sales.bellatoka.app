# Cheryl Newton Real Estate Website

## Project Overview

A modern, lead-generating residential real estate website for Cheryl Newton, a Berkshire Hathaway HomeServices Broker Associate serving Orange County, California, along the LA-to-San Diego corridor. Specializes exclusively in residential properties (no commercial).

## Tech Stack

- **Frontend**: React 19, Vite 7, Tailwind CSS v4, React Router v7
- **Backend**: Express.js API server (port 3001) for local dev + Netlify Functions for production
- **Database**: PostgreSQL (Replit-hosted for dev, Neon for production)
- **Deployment Target**: Netlify + GoDaddy DNS (Replit is for development/testing ONLY)
- **Primary Domain**: newton4.homes

## Architecture: Netlify + Neon (Production) vs Replit (Dev Only)

**IMPORTANT**: The Express server (`server/index.js`) is for local development testing in Replit ONLY. Production runs on Netlify Functions + Neon database. Never use the Replit server for production.

- **All fetch calls**: Use `/api/*` paths everywhere (no environment switching needed)
- **Dev routing**: Vite proxy forwards `/api/*` to Express server on port 3001
- **Prod routing**: `netlify.toml` redirects `/api/*` to `/.netlify/functions/*`

## Project Structure

```
├── server/
│   └── index.js           # Express API server (dev only, port 3001)
├── src/
│   ├── components/
│   │   ├── Header.jsx
│   │   ├── Footer.jsx
│   │   ├── PropertyCard.jsx
│   │   ├── TestimonialCard.jsx
│   │   ├── LeadForm.jsx
│   │   ├── AddListingForm.jsx
│   │   └── SEO.jsx         # SEO, RealEstateAgentSchema, PropertySchema, BreadcrumbSchema
│   ├── pages/
│   │   ├── Home.jsx
│   │   ├── Listings.jsx
│   │   ├── ListingDetail.jsx
│   │   ├── HomeValue.jsx
│   │   ├── About.jsx
│   │   ├── Contact.jsx
│   │   ├── Neighborhood.jsx  # Dynamic pages for 21 cities
│   │   ├── Resources.jsx
│   │   ├── SEOPage.jsx
│   │   ├── GEOPage.jsx       # AI-optimized with FAQs, residential focus
│   │   ├── Test.jsx
│   │   └── Admin.jsx          # Admin panel with Messages, Home Value, Testimonials tabs
│   ├── data/
│   │   └── listings.js        # 21 neighborhoods, templates, testimonials
│   ├── utils/
│   │   └── analytics.js
│   ├── App.jsx
│   ├── main.jsx
│   └── index.css
├── netlify/
│   └── functions/
│       ├── auth.js           # Admin login/token verification
│       ├── analytics.mjs     # Page views, listing views tracking
│       ├── listings.js       # CRUD for listings (Neon DB)
│       ├── contact.js        # Contact form leads (saves to Neon DB)
│       └── testimonials.js   # CRUD for testimonials (Neon DB)
├── public/
│   ├── favicon.svg
│   ├── robots.txt            # Allows all AI bots (GPTBot, ClaudeBot, etc.)
│   ├── sitemap.xml           # 29 URLs (8 main + 21 neighborhoods)
│   ├── llms.txt              # AI crawler summary (residential-focused)
│   ├── llms-full.txt         # Comprehensive AI crawler content
│   └── _headers
├── netlify.toml              # Redirects for all API routes
├── vite.config.js
├── tailwind.config.js
├── postcss.config.js
└── package.json
```

## Key Features

1. **Homepage** - Hero section, featured listings from DB, stats, testimonials
2. **Property Listings** - Search/filter from PostgreSQL, detailed view pages
3. **Home Valuation** - Lead capture form for seller valuations
4. **Neighborhood Guides** - 21 city-specific landing pages with SEO/schema
5. **Admin Panel** - Listings CRUD, Messages inbox, Home Value leads tab, Testimonials CRUD, badge alerts, profile, analytics dashboard
6. **Contact Form** - Leads saved to database, viewable in admin Messages tab
7. **Analytics** - Visitor tracking with page views, listing views, locations
8. **SEO/GEO** - Structured data (JSON-LD), meta tags, sitemap, robots.txt, BreadcrumbList schema
9. **AI Optimization** - llms.txt, llms-full.txt, FAQPage schema, residential-only signaling

## Service Areas (21 Cities)

Irvine, Newport Beach, Laguna Niguel, Mission Viejo, Dana Point, Laguna Beach, Huntington Beach, Aliso Viejo, San Clemente, Lake Forest, Rancho Santa Margarita, Ladera Ranch, San Juan Capistrano, Tustin, Costa Mesa, Yorba Linda, Anaheim Hills, Fullerton, Brea, Placentia, Seal Beach

## Database Tables

### listings
Full MLS data: address, city, state, zip, price, status, property_type, beds, baths, sqft, photos, etc.

### leads
Contact form submissions: name, email, phone, form_type, message, property_address, buying_timeline, price_range, source, visitor_ip, status, created_at

### page_views
Analytics: page_path, visitor_ip, user_agent, referrer, city, region, country, created_at

### listing_views
Analytics: listing_id, listing_address, listing_city, visitor_ip, time_spent_seconds, city, region, country, created_at

### testimonials
Client testimonials: name, location, text, rating, date, is_active, created_at

## API Endpoints

### Express Server (Dev, port 3001)
- `GET/POST /api/listings`, `GET/PUT/DELETE /api/listings/:id`
- `POST /api/auth` (login/verify)
- `GET/POST /api/contact` (leads)
- `GET/POST/DELETE /api/testimonials` (testimonials CRUD)
- `GET/POST /api/analytics`
- `POST /api/upload` (photos)

### Netlify Functions (Production)
- `/.netlify/functions/listings`
- `/.netlify/functions/auth`
- `/.netlify/functions/contact`
- `/.netlify/functions/testimonials`
- `/.netlify/functions/analytics`

## Environment Variables

| Variable | Purpose | Where |
|----------|---------|-------|
| DATABASE_URL | PostgreSQL (Replit dev) | Replit |
| NEON_DATABASE_URL | Neon PostgreSQL (production) | Netlify |
| NETLIFY_DATABASE_URL | Neon via Netlify integration | Netlify |
| ADMIN_PASSWORD_HASH | Admin login password | Both |
| SESSION_SECRET | Token signing key | Both |
| SPARK_API_KEY | Bridge API token (MLS sync) | Netlify |

## User Preferences

- Clean, professional design with blue/white color scheme
- Lead-generation focused, mobile responsive
- Residential properties ONLY (no commercial/industrial/land)
- Focus on Orange County, LA-to-San Diego corridor
- SEO/GEO optimization for AI chatbots (Gemini, ChatGPT)
- Netlify + Neon for production; Replit for development only

## Recent Changes (Feb 12, 2026)

- **Contact form Message Title dropdown**: Added dropdown on contact page with 5 options (General Message, Buyer's Guide Request, Seller's Guide Request, Home Buying Checklist, Other). Only appears on main contact form, not on buyer or neighborhood forms. Title is prepended to message on submission.
- **Resources page guide links**: "Request Guide" and "Home Buying Checklist" buttons now navigate to /contact with the appropriate message title pre-selected via React Router state.
- **About page stat update**: Replaced "500+ Homes Sold" with "2025 Chairman's Circle Gold Award" stat with Award icon.
- **Neighborhood interest tracking**: Submissions from neighborhood pages save as form_type='neighborhood_interest' with source='/neighborhoods/{city-id}'. New "Neighborhood" tab in admin dashboard with badge count, mark-as-read, and delete functionality.
- **Footer X.com logo**: Replaced Twitter bird icon with custom X.com SVG logo.
- **Scroll-to-top**: All page navigations now scroll to top via useEffect on location.pathname in App.jsx.
- **Admin Analytics User Index**: Added "Users" sub-tab to Analytics with visitor tracking by IP. Each visitor gets a label (User 1, User 2, etc.). AI/bot traffic is detected and flagged using user-agent patterns (GPTBot, ClaudeBot, Googlebot, etc.). Shows total views, pages visited, first/last visit, location. Mock data only in dev mode, never on live site.
- **All images localized**: Replaced all third-party Unsplash URLs with locally stored images in `public/images/` and `public/images/neighborhoods/`. Includes 21 city photos, hero background, template listing photos, and page section images.
- **Neighborhood images updated**: All 21 city images now show actual city/area photos instead of house photos
- **Median prices set to "Data Pending"**: All neighborhood pages now show "Data Pending" for median price until live data feed is connected
- **City info links**: Replaced "Avg. Days on Market" stat with clickable link to each city's official website on all 21 neighborhood pages
- **Chairman's Circle Gold Award section**: Added award showcase on home page below "Thinking About Selling?" — 2025 Chairman's Circle Gold Award, top 3% of 45,000 Berkshire Hathaway HomeServices agents
- **Resources page fixed**: All broken download/guide buttons now redirect to contact page. Mortgage Calculator links to Bankrate. Neighborhood Guides links to homepage neighborhoods section. Subscribe form now saves to leads database.
- Added `action=users` analytics API endpoint to Express server
- Added `ExternalLink` icon usage to Neighborhood page
- Home page neighborhoods section now shows city descriptions instead of listing prices

## Previous Changes (Feb 9, 2026)

- **Migrated admin settings from browser to database**: Template visibility toggles (listings + testimonials) and lead read tracking now stored in PostgreSQL `settings` table and `leads.read_at` column, so changes are universal across all browsers/devices
- Created `settings` table (key/value store) with GET/PUT API endpoints
- Added `read_at` TIMESTAMP column to `leads` table with PATCH `/api/contact/:id/read` endpoint
- Created `netlify/functions/settings.js` for production settings API
- Updated all pages (Home, About, Listings, Neighborhood) to fetch template visibility from database
- Admin dashboard toggle buttons and lead read status now persist server-side
- Added template testimonials toggle in admin Testimonials tab (show/hide pattern matching listings toggle)
- Homepage and About page now fetch and display DB testimonials alongside template ones
- "Explore Orange County Neighborhoods" section on homepage now only shows cities with real DB listings or visible template listings (no placeholder cities)
- Neighborhood cards show listing photo and price from actual listing data
- Added Testimonials admin tab with add/delete functionality (DB-backed via `testimonials` table)
- Added separate Home Value Leads tab filtering valuation requests from general messages
- Added numbered badge alerts on admin sidebar for new messages and home value leads
- Removed unused Images tab from admin dashboard
- Created `netlify/functions/testimonials.js` for production CRUD
- Added testimonials API routes to Express dev server

## Previous Changes (Feb 8, 2026)

- **Fixed critical production NaN bug**: Netlify passes `event.path` as the original request path (`/api/listings`) not the function path (`/.netlify/functions/listings`). The old path parser only stripped the function prefix, leaving `'api'` as the listingId. `parseInt('api')` returned NaN, causing `WHERE id = NaN` → "invalid input syntax for type integer". Fix: strip both path prefixes and validate listingId is numeric with regex before use.
- Added diagnostic endpoint (`/api/listings?action=diagnose`) for production DB health checks
- Added deep repair endpoint (`/api/listings?action=fix`, auth-required) for column type conversion cleanup
- Simplified Admin.jsx error handling (removed unnecessary auto-repair cascading)

### Previous Changes (Feb 8, 2026)

- Integrated Cloudinary for image uploads (both Netlify Functions and Express dev server)
- Netlify upload function now handles base64 JSON and multipart form uploads to Cloudinary
- Express dev server upload route streams to Cloudinary when configured, falls back to local disk
- Fixed Listings page: now shows both DB listings AND template listings from data/listings.js
- Fixed Home page: featured properties section now combines DB + template listings
- Cloudinary credentials stored as secrets: CLOUDINARY_CLOUD_NAME, CLOUDINARY_API_KEY, CLOUDINARY_API_SECRET
- Fixed auth bug: handleSaveListing, handleDeleteListing now include Authorization Bearer token
- Fixed photo upload: all 3 form components include auth tokens
- **Fixed critical production routing bug**: Removed API_BASE prefix pattern from all frontend files. All fetch calls now use plain `/api/...` paths. Netlify's `netlify.toml` redirects handle prod routing (`/api/listings` → `/.netlify/functions/listings`), Vite proxy handles dev routing. This fixes listings not appearing on the live site.
- Added URL-based photo entry ("Add URL" button) to all 3 listing forms (Web, MLS, original)
- Added /api/upload redirect to netlify.toml
- Added mls_data JSONB column to listings table (dev + prod schemas)
- Added "Add Listing" tab to admin with Web Listing / MLS Listing chooser
- Built AddWebListingForm (simplified) and AddMLSListingForm (full CRMLS-style, 10 tabs)

## Previous Changes (Feb 7, 2026)

- Added leads saving to Neon DB via contact.js Netlify function
- Added Messages/Leads tab to admin dashboard
- Added local dev routes for auth, contact, analytics in Express server
- Added netlify.toml redirects for contact, auth, analytics
- Expanded neighborhoods from 6 to 21 cities
- Added residential-only signaling across schema, meta tags, GEO page
- Expanded GEO page with LA-to-SD corridor framing and 14 FAQs
- Updated llms.txt and llms-full.txt with comprehensive residential content
- Updated sitemap.xml with all 29 pages
- Added BreadcrumbList schema across all main pages
- Expanded RealEstateAgentSchema areaServed to 21 cities
